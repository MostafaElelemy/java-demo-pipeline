@Library('acme-lib@main') _
import org.acme.Utils

pipeline {
  agent any
  options { timestamps(); buildDiscarder(logRotator(numToKeepStr: '3')); disableConcurrentBuilds() }
  tools   { jdk 'jdk17'; maven 'maven-3.9' }

  stages {
    stage('Checkout'){ steps { checkout scm } }

    stage('Build via Library'){
      steps {
        say('ğŸ”§ Building with shared libraryâ€¦')
        // ØºÙŠÙ‘Ø± Ø§Ù„Ø£Ù‡Ø¯Ø§Ù Ù„Ùˆ Ø¹Ø§ÙŠØ² ØªØªØ®Ø·Ù‘Ù‰ Ø§Ù„ØªØ³Øª Ù…Ø¤Ù‚ØªÙ‹Ø§: '-B -q -DskipTests clean package'
        mvnBuild(goals: '-B -q clean test package')
      }
    }

    stage('Gate from Utils'){
      steps { script { Utils.gate(this, env.BUILD_NUMBER as Integer) } }
    }
  }

  post { success { echo 'âœ… DONE' }; failure { echo 'âŒ FAILED' }; always { cleanWs() } }
}
